Версия: 1.04
Дата 16.11.2018
Назначение: Переприем данных.
Микроконтроллер: ATmega164

Данная программа реализует функции:
- клеммники приемника (дискретные выходы);
- клеммники передатчика (дискретные входы);
- протокол общения по ЦПП Modbus;
- протокол общения с БСП Стандартный.

Светодиоды:
- VD19 - показывает активность протокола общения с МК БСП. Меняет состояние при каждом приеме сообщения.
- VD20 - показывает активность протокола Modbus. Меняет состояние при каждом приеме сообщения.

В случае отсутствия принятых сообщений в течении 20 мс, полученные данные с соответствующего протокола обнуляются.
Например, если пропала связь с МК БСП, в Modbus будут уходить значения всех регистров 0x0000. И наоборот.

Для контрольных сигналов протокол Modbus выступает в качестве замены УМ/Оптики:
- КС записываемая в Modbus (Holding Registers) это частота передаваемая по УМ/Оптике;
- КС считываемая по Modbus (Input Register) это частота получаемая из УМ/Оптики.

Для дискретных сигналов протокол Modbus выступает в качестве замены клеммников:
- сигналы записываемые Modbus (Holding Registers) это уоманды передаваемые в КПРМ;
- сигналы считываемые по Modbus (Input Register) это команды получаемые из КПРД.

//---MODBUS---------------------------------------------------------------------

	Адрес устройства: 1. 
	Скорость передачи данных: 115200 бит/с.
	Количество бит данных: 8.
	Соличество стоп бит: 1.
	Контрроль четности: нет.
		
	Holding Registers (0x03)
		Дискретные входы. Установленный бит означает наличие команды.
		1 или 3 -> команды с 16 по 1.
		2 или 4 -> команды с 32 по 17.
		5 или 6 -> контрольные сигналы, (1 - принимается).
		
	Holding Registers (0x06, 0x10):
		Дискретные входы. 
		1 -> входы с 16 по 1, устанавливаются по маске (1 - установка). 
		2 -> входы с 32 по 17, устанавливаются по маске (1 - установка).
		3 -> входы с 16 по 1, сброс по маске (1 - сброс).
		4 -> входы с 32 по 17, сброс по маске (1 - сброс).
		5 -> контрольные сигналы, устанавливаются по маске (1 - установка).
		6 -> контрольные сигналы, сброс по маске (1 - сброс)
		 
	Input Registers (0x04):
		Дискретные выходы.
		1 -> выходы с 16 по 1, (1 - установлен).
		2 -> выходы с 32 по 17, (1 - установлен).
		3 -> контрольные сигналы, (1 - передается).
		
//---MODBUS ПРИМЕР КОМАНД ДЛЯ РАБОТЫ--------------------------------------------		

Установка и сброс значений дискретных входов (DI):
	Запрос	: 01 06 00 00 00 01 48 0A
			  		|     |     | CRC		
			        |     | установка команд, в данном случае DI 1
			        | адрес регистра, в данном сучае для DI с 16 по 1
	Ответ	: 01 06 00 00 00 01 48 0A (повторяет запрос)
	
	Запрос	: 01 06 00 00 02 01 49 6A
			  		|     |     | CRC		
			        |     | установка команд, в данном случае DI 1 и 10
			        | адрес регистра, в данном сучае для DI с 16 по 1
	Ответ	: 01 06 00 00 02 01 49 6A (повторяет запрос)
	
	Запрос	: 01 06 00 01 80 00 B9 CA
					|     |     | CRC		
			        |     | установка команд, в данном случае DI 32
			        | адрес регистра, в данном случае для DI с 32 по 17
	Ответ	: 01 06 00 01 80 00 B9 CA (повторяет запрос)
	
	Запрос	: 01 06 00 02 02 01 E8 AA
				    |     |     | CRC		
			        |     | сброс команд, в данном случае DI 1 и 10
			        | адрес регистра, в данном случае для DI с 32 по 17
	Ответ	: 01 06 00 02 02 01 E8 AA (повторяет запрос)
	
	Запрос	: 01 06 00 03 80 00 18 0A
					|     |     | CRC		
			        |     | сброс команд, в данном случае DI 32
			        | адрес регистра, в данном случае для DI с 32 по 17
	Ответ	: 01 06 00 03 80 00 18 0A (повторяет запрос)
	
	Запрос	: 01 10 00 00 00 02 04 10 00 00 10 F6 A3
			        |     |     |  |     |     | CRC
			        |     |     |  |     | DI с 32 по 17, в данном случае 21
			        |     |     |  |DI с 16 по 1, в данном случае 16
			        |     |     | количество байт данных для передачи  
			        |     | количество адресов для передачи
			        |адрес первого регистра
	Ответ	: 01 10 00 00 00 02 41 C8 (повторяет заголовок запроса).   
	
	Запрос	: 01 10 00 01 00 02 04 10 00 00 10 37 6F
			        |     |     |  |     |     | CRC
			        |     |     |  |     | сброс DI с 16 по 1, в данном случае 21
			        |     |     |  | установка DI с 32 по 17, в данном случае 16
			        |     |     | количество байт данных для передачи  
			        |     | количество адресов для передачи
			        |адрес первого регистра
	Ответ	: 01 10 00 01 00 02 10 08 (повторяет заголовок запроса).                 	 
		
Считывание значений дискретных входов (DI):
	Запрос	: 01 03 00 00 00 02 C4 0B
	Ответ	: 01 03 XX XX YY YY cr cr	
			        |     |     | CRC		
			        |     | DI с 32 по 17
			        | DI с 16 по 1
				        
Считывание значений дискретных выходов (DO):
	Запрос	: 01 04 00 00 00 02 71 CB 
	Ответ	: 01 04 XX XX YY YY cr cr	
			        |     |     | CRC		
			        |     | DO с 32 по 17
			        | DO с 16 по 1
 
//------------------------------------------------------------------------------